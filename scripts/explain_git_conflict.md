# Объяснение конфликта Git простыми словами

## Что происходит?

У вас есть **два места**, где хранятся файлы миграций:

### 1. **Локальные изменения** (на вашем сервере)
- Это файлы, которые **вы изменили** на сервере `83.166.246.205`
- Они находятся в папке `/home/aviapoint_server/migrations/`
- Git видит, что эти файлы отличаются от того, что было в последнем коммите

### 2. **Удалённые изменения** (на GitHub)
- Это файлы, которые **кто-то другой изменил** (или вы из другого места)
- Они находятся в репозитории на GitHub: `https://github.com/DartFlutterWorld/aviapoint_server`
- Кто-то сделал `git push`, и теперь эти изменения есть на GitHub

## Проблема

Git не может автоматически объединить изменения, потому что:
- **Локально** вы изменили файлы `071_add_content_and_images_to_news.sql` и `072_sync_all_tables_and_fields.sql`
- **На GitHub** эти же файлы тоже были изменены
- Git не знает, какие изменения правильные - ваши локальные или удалённые

## Визуализация

```
Локально (на сервере):          GitHub (удалённо):
┌─────────────────────┐         ┌─────────────────────┐
│ Файл миграции       │         │ Файл миграции       │
│ (ваша версия)       │  ❌     │ (версия с GitHub)    │
│ строка 10: SELECT   │  ≠      │ строка 10: PERFORM   │
└─────────────────────┘         └─────────────────────┘
```

## Что делать?

### Шаг 1: Посмотреть, что изменилось

```bash
# На сервере выполните:
cd /home/aviapoint_server

# Посмотреть ВАШИ локальные изменения (что вы изменили)
git diff migrations/071_add_content_and_images_to_news.sql
```

Это покажет:
- `+` (зелёный) - строки, которые вы добавили/изменили
- `-` (красный) - строки, которые вы удалили

### Шаг 2: Посмотреть, что изменилось на GitHub

```bash
# Посмотреть изменения с GitHub (что пришло из удалённого репозитория)
git fetch origin
git diff HEAD origin/main -- migrations/071_add_content_and_images_to_news.sql
```

## Решения

### Решение 1: Оставить ВАШИ изменения (локальные)

**Когда использовать:** Если вы исправили ошибку в миграции (например, "query has no destination")

```bash
# Сохранить ваши изменения
git add migrations/071_add_content_and_images_to_news.sql migrations/072_sync_all_tables_and_fields.sql
git commit -m "Исправление ошибок в миграциях"

# Попытаться обновить (может быть конфликт)
git pull origin main
```

### Решение 2: Взять изменения с GitHub (удалённые)

**Когда использовать:** Если ваши локальные изменения не важны, а на GitHub правильная версия

```bash
# Отменить ваши локальные изменения
git checkout -- migrations/071_add_content_and_images_to_news.sql migrations/072_sync_all_tables_and_fields.sql

# Взять версию с GitHub
git pull origin main
```

### Решение 3: Объединить оба (если нужно)

**Когда использовать:** Если важны и ваши изменения, и изменения с GitHub

```bash
# Сохранить ваши изменения во временное хранилище
git stash

# Взять изменения с GitHub
git pull origin main

# Вернуть ваши изменения обратно
git stash pop

# Если Git покажет конфликты, нужно будет разрешить их вручную
```

## Как понять, что выбрать?

1. **Выполните команды для просмотра изменений:**
   ```bash
   git diff migrations/071_add_content_and_images_to_news.sql
   ```

2. **Посмотрите на вывод:**
   - Если видите исправления ошибок (например, `SELECT` → `PERFORM`, или добавление `INTO column_exists`) → **ваши изменения важны** → Решение 1
   - Если видите только мелкие правки форматирования → можно взять версию с GitHub → Решение 2
   - Если не уверены → Решение 3 (объединить)

## Пример вывода git diff

```diff
--- a/migrations/071_add_content_and_images_to_news.sql
+++ b/migrations/071_add_content_and_images_to_news.sql
@@ -8,7 +8,10 @@
 DO $$ 
 BEGIN
-    IF NOT EXISTS (SELECT 1 FROM ...) THEN
+    DECLARE column_exists BOOLEAN;
+    SELECT EXISTS (...) INTO column_exists;
+    IF NOT column_exists THEN
```

Это показывает, что **ваша версия** исправляет ошибку (добавляет `DECLARE` и `INTO`), значит ваши изменения важны!
