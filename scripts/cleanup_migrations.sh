#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ –º–∏–≥—Ä–∞—Ü–∏–π - –æ—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ –±–∞–∑–æ–≤—É—é —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –≤ –ø—Ä–æ–µ–∫—Ç–µ aviapoint_server –ª–æ–∫–∞–ª—å–Ω–æ

echo "üßπ –û—á–∏—Å—Ç–∫–∞ –º–∏–≥—Ä–∞—Ü–∏–π - –æ—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ –±–∞–∑–æ–≤—É—é —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é..."
echo ""
echo "–í–ê–ñ–ù–û: –í—ã–ø–æ–ª–Ω–∏—Ç–µ —ç—Ç–æ –≤ –õ–û–ö–ê–õ–¨–ù–û–ú –ø—Ä–æ–µ–∫—Ç–µ aviapoint_server!"
echo ""
echo "cd ~/Projects/aviapoint_server  # –∏–ª–∏ –ø—É—Ç—å –∫ –≤–∞—à–µ–º—É –ª–æ–∫–∞–ª—å–Ω–æ–º—É –ø—Ä–æ–µ–∫—Ç—É"
echo ""
echo "# 1. –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ –º–∏–≥—Ä–∞—Ü–∏–∏"
echo "ls -la migrations/*.sql | wc -l"
echo "ls migrations/*.sql"
echo ""
echo "# 2. –ù–∞–π—Ç–∏ –±–∞–∑–æ–≤—É—é –º–∏–≥—Ä–∞—Ü–∏—é —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ (—Å–∫–æ—Ä–µ–µ –≤—Å–µ–≥–æ 072_sync_all_tables_and_fields.sql)"
echo "ls migrations/072*.sql migrations/*sync*.sql 2>/dev/null"
echo ""
echo "# 3. –ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ —Å –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º –≤ –ø–∞–ø–∫—É old_migrations (–¥–ª—è –∏—Å—Ç–æ—Ä–∏–∏)"
echo "mkdir -p migrations/old_migrations"
echo "mv migrations/insert_aircraft_catalog_data*.sql migrations/old_migrations/ 2>/dev/null"
echo ""
echo "# 4. –£–¥–∞–ª–∏—Ç—å –∏–ª–∏ –æ—Ç–∫–ª—é—á–∏—Ç—å –¥—Ä—É–≥–∏–µ –ø—Ä–æ–±–ª–µ–º–Ω—ã–µ –º–∏–≥—Ä–∞—Ü–∏–∏"
echo "# –£–¥–∞–ª–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ –¥–æ–±–∞–≤–ª—è—é—Ç –∫–æ–Ω—Ç–µ–Ω—Ç, –∞ –Ω–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—É:"
echo "# - insert_aircraft_catalog_data*.sql"
echo "# - clear_all_flights_data.sql (–µ—Å–ª–∏ –Ω–µ –Ω—É–∂–Ω–∞)"
echo "# - –¥—Ä—É–≥–∏–µ insert/update –º–∏–≥—Ä–∞—Ü–∏–∏ —Å –¥–∞–Ω–Ω—ã–º–∏"
echo ""
echo "# 5. –û—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ:"
echo "# - –ë–∞–∑–æ–≤—É—é –º–∏–≥—Ä–∞—Ü–∏—é —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ (072_sync_all_tables_and_fields.sql)"
echo "# - –ú–∏–≥—Ä–∞—Ü–∏–∏ —Å–æ–∑–¥–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü (create_*.sql)"
echo "# - –ú–∏–≥—Ä–∞—Ü–∏–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã (add_*, alter_*, rename_*)"
echo ""
echo "# 6. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –±–∞–∑–æ–≤–∞—è –º–∏–≥—Ä–∞—Ü–∏—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ (–Ω–µ—Ç –ø—Ä–æ–±–ª–µ–º —Å SELECT, is_active)"
echo "grep -n 'SELECT.*FROM news' migrations/072_sync_all_tables_and_fields.sql | grep -v 'INTO' | grep -v 'EXISTS'"
echo "grep -n 'is_active' migrations/072_sync_all_tables_and_fields.sql | grep -i index"
echo ""
echo "# 7. –ó–∞–∫–æ–º–º–∏—Ç–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è"
echo "git add migrations/"
echo "git commit -m 'Cleanup: —É–¥–∞–ª–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π —Å –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º, –æ—Å—Ç–∞–≤–ª–µ–Ω–∞ —Ç–æ–ª—å–∫–æ –±–∞–∑–æ–≤–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è'"
echo "git push"
echo ""
echo "# 8. –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ:"
echo "ssh root@83.166.246.205"
echo "cd /home/aviapoint_server"
echo "git pull"
echo "docker-compose -f docker-compose.prod.yaml restart aviapoint-server"
echo ""
