# Правила разработки проекта AviaPoint
- При разработке и решении мною поставленных задач используй этот репозиторий с подсказками
https://github.com/MADTeacher/mad-agents-skills

## Архитектура проекта

### Clean Architecture
Проект использует Clean Architecture с разделением на слои:
- **data/** - источники данных (API, БД), модели (DTO), мапперы (DTO -> Entity), репозитории (реализация)
- **domain/** - бизнес-логика: entities, repositories (интерфейсы)
- **presentation/** - UI: pages, widgets, bloc/cubit

### Паттерны управления состоянием

#### BLoC Pattern
- **ВСЕГДА** используй BLoC/Cubit для управления состоянием
- **НИКОГДА** не используй setState для обновления данных из BLoC
- Используй Freezed для событий и состояний
- Обработка событий через `event.map()` или `on<Event>((event, emit) => ...)`

#### Состояния BLoC
- Стандартные состояния: `loading`, `error`, `success`
- Для ошибок используй структуру:
  error: {
    String? errorFromApi,
    required String errorForUser,
    String? statusCode,
    StackTrace? stackTrace,
    String? responseMessage,
  }
  - для loading - CustomLoading
  - для error-состояний в BLoC передавай поля по шаблону, как в `NewsBloc`:
    - `errorForUser`: всегда дружелюбный текст для пользователя, например `'Что-то пошло не так!\nПопробуйте повторить запрос'`
    - `errorFromApi`: `l.message` (сырой текст ошибки с бэкенда)
    - `statusCode`: строка вида `'Код ошибки сервера: \${l.statusCode}'`
    - `responseMessage`: `l.responseMessage`
    - `stackTrace`: прокидывай, если есть
    Пример:
    `ErrorNewsState(errorForUser: 'Что-то пошло не так!\\nПопробуйте повторить запрос', errorFromApi: l.message, statusCode: 'Код ошибки сервера: \${l.statusCode}', responseMessage: l.responseMessage)`
 # Что примнять cubit или setState
- максимально использовать cubit

  ### Работа с API
- **ВСЕГДА** создавай отдельный Service (Retrofit) для каждого репозитория
- Service размещается в `data/datasources/`
- Service определяет API endpoints через аннотации (`@GET`, `@POST`, `@PUT`, `@DELETE` и т.д.)
- Service возвращает только DTO
- RepositoryImpl использует Service для получения DTO, затем преобразует через Mapper в Entity
- Service не должен знать об Entity, только о DTO

### Dependency Injection (DI)

#### GetIt для синглтонов
- **ВСЕГДА** используй `GetIt` (get_it) для регистрации синглтонов
- Регистрация происходит в `lib/injection_container.dart` через `getIt.registerSingleton<T>()`
- Как синглтоны регистрируются:
  - Все репозитории (Repository)
  - Сервисы (Service) при необходимости
  - Другие глобальные зависимости (ApiDatasource, AppRouter, AppState, AppDb и т.д.)



####  Првило использования BLoC на страницах
- Для каждого действия использум отдельный  (BLoC), который будет управлять состоянием этого действия.



#### Регистрация BLoC
Используй глобальную регистрацию для:
Списков (AircraftMarketBloc, PartsMarketBloc, NewsBloc и др)
Глобального состояния (AuthBloc, ProfileBloc, AppSettingsBloc и др.)
`lib/core/presentation/pages/app.dart` через `MultiProvider` с `BlocProvider`

Для  deail экранов используй локальную регистрацию:
- Detail-экранов, если состояние должно сбрасываться при открытии
- Модальных окон/диалогов с собственным состоянием
- Виджетов, которые могут использоваться независимо
Важно: если используешь локальную регистрацию, создавай BLoC в initState или через BlocProvider.value, а не в build.

### При создании ui экранов используй, ели есть соответствующий виджет:
- CustomAppBar
- CustomBottomNavigationBar
- CustomButton
- **CustomTextField** - **ВСЕГДА** используй CustomTextField вместо TextFormField/TextField для единообразия
- CustomDropdownButton
- CustomCheckbox
- CustomRadio
- CustomSwitch
- CustomSlider
- CustomProgressIndicator
- CustomAlertDialog
- UniversalBottomSheet

### Обработка ошибок в UI
- **ВСЕГДА** используй `ErrorCustom` для отображения ошибок загрузки данных на экранах (в том числе в маркете), вместо самописных `Column/Text/ElevatedButton`.
- Для повторной попытки передавай в `ErrorCustom.repeat` колбэк, который заново диспатчит событие в соответствующий BLoC (например, повторный `getProducts` / `getParts` или `refresh`).

### Раздел "Работа" (вакансии и резюме)
- **Списки вакансий и резюме**:
  - Используй отдельные BLoC-и с пагинацией (`JobsVacanciesBloc`, `JobsResumesBloc`).
  - Стандартные состояния: `loading`, `loadingMore`, `success(vacancies/resumes, hasMore)`, `error(...)` по общей схеме ошибок.
  - В UI для ошибок списков ВСЕГДА используй `ErrorCustom` с дружелюбным `errorForUser` и `repeat`, который диспатчит `get`/`refresh` в BLoC.
- **Детальные экраны**:
  - Для деталей вакансии/резюме используй отдельные BLoC-и (`JobVacancyDetailBloc`, `JobResumeDetailBloc`) с состояниями `loading`, `success`, `error(...)` по общей схеме.
  - Кнопки действий (редактировать/удалить/публиковать) выноси в `CustomAppBar.actions` либо в явные кнопки внизу экрана.
  - Для ошибок на деталях также используй `ErrorCustom` + повторное событие `getById`.
- **Создание / редактирование**:
  - Для создания/редактирования вакансий и резюме используй отдельные BLoC-и действий (`JobVacancyEditBloc`, `JobResumeEditBloc`) с состояниями:
    - `initial`, `creating/updating/deleting`, `created/updated/deleted`, `error(...)`.
  - Формы всегда строятся на `CustomTextField` + `DropdownButtonFormField`/bottom sheet, высота инпутов выравнивается через `contentPadding: EdgeInsets.symmetric(horizontal: 12, vertical: 12)` под высоту `CustomTextField`.
  - Обязательные поля (например, заголовок вакансии/резюме) помечай `*` в label и валидируй через `validator`.
  - На успех действия показывай `SnackBar` с коротким сообщением (`"Вакансия создана"`, `"Резюме обновлено"`) и закрывай экран через `context.router.maybePop()`.
  - На ошибку всегда показывай `SnackBar` с `errorForUser` из состояния BLoC.
- **Навигация**:
  - Для переходов в раздел "Работа" и детальных экранов используй маршруты `WorkRoute`, `JobVacancyDetailRoute`, `JobResumeDetailRoute`, а для создания/редактирования — `CreateJobVacancyRoute`, `EditJobVacancyRoute`, `CreateJobResumeRoute`, `EditJobResumeRoute`.
  - Не используй ручные `Navigator.push`, всегда работай через `context.router.push(...)`.

#### Паддинги в UI
- **Горизонтальные паддинги на экранах**: всегда 8px (`EdgeInsets.symmetric(horizontal: 8, vertical: 16)`)
- **Отступы между секциями**: всегда 16px (`SizedBox(height: 16)`)
- Используй `EdgeInsets.symmetric(horizontal: 8, vertical: 16)` для `SingleChildScrollView` padding на экранах



# Бэкенд находится в папке ../aviapoint_server